---
description: MCP Protocol Implementation Rules
globs: **/Mcp/**/*.cs, **/Protocol/**/*.cs, **/Server/**/*.cs
alwaysApply: false
---
# MCP Protocol Implementation Rules

This rule provides guidance for implementing the Model Context Protocol (MCP) in the .NET Codebase Context Server.

## MCP Protocol Guidelines
- Implement the MCP protocol according to the official specification
- Use proper JSON serialization/deserialization for MCP messages
- Handle tool registration and invocation in a consistent manner
- Implement proper error handling for all MCP operations
- Ensure all tool responses follow the MCP format

## Message Format
- Tool declarations must include name, description, and parameters
- Tool call requests must include id, name, and parameters
- Tool call responses must include id and result or error
- All JSON should be properly formatted and validated

## Communication
- Implement STDIO communication as the primary transport
- Each message should be a complete JSON object on a single line
- Messages should be terminated with a newline character
- Consider implementing WebSocket communication as a stretch goal

## Error Handling
- Return structured error responses for all failure cases
- Include appropriate error codes and descriptive messages
- Handle timeouts and resource limitations gracefully
- Log all errors for debugging purposes

## Security
- Validate all input parameters before processing
- Implement proper path validation for file access
- Consider rate limiting for resource-intensive operations
- Never execute code from the codebase being analyzed 